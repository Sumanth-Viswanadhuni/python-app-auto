name : PYTHONAPP
trigger:
  branches:
    include:
      - master
 
pool:
  vmImage: 'ubuntu-latest'
 
variables:
  AzureSubscription: 'serviceconnection-manual' # Name of the Service Connection
  ApiName: 'python-app'
  BuildId: $(Build.BuildId)
  buildNumber: $(BuildNumber)
  ArtifactName: 'python-app'
  ClusterResourceGroup: MyResourceGroup  
  ChartPackage: '$(Build.ArtifactStagingDirectory)/$(ApiName)-$(Build.BuildId).tgz'  
  artifactStagingDirectory: $(Build.ArtifactStagingDirectory)
  ChartPath: $(ApiName)
  HelmVersion: 3.5.0
  K8sNamespace: '$(Apiname)-test'
  KubernetesCluster: 'myAKSCluster'
  Repository: 'sumanthviswanadhuni/$(ApiName)'
  ReleaseValuesFile: '$(ChartPath)/values.yaml'
  
stages:
- stage: Build
  displayName: Build image
  jobs:  
  - job: Build
    displayName: Build and push Docker image
    steps:
    - template: ./template/CI-steps.yaml
    - template: ./template/helm-install.yml   
    - template: ./template/helm-deploy.yml   
    - template: ./template/helm-deploy-upgrade.yml
